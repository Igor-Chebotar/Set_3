# Отчёт по задаче A1
## Экспериментальное исследование метода Монте-Карло для вычисления площади пересечения окружностей

---

## 1. Введение

В рамках данной работы я исследовал применение метода Монте-Карло для оценки площади сложной геометрической фигуры. Конкретно — фигуры, образованной пересечением трёх окружностей.

Метод Монте-Карло основан на генерации случайных точек и подсчёте доли тех из них, которые попадают в интересующую нас область. Это довольно универсальный подход, который позволяет оценивать площади и объёмы фигур, для которых аналитическое решение либо слишком сложное, либо вообще невозможно.

В моём случае задача хоть и имеет аналитическое решение (площадь можно вычислить через формулы для сегментов и треугольников), но формула получается громоздкой. Поэтому интересно посмотреть, насколько хорошо метод Монте-Карло справляется с этой задачей и какое количество случайных точек нужно сгенерировать для достижения приемлемой точности.

### Постановка задачи

Даны три окружности:
- Окружность 1: центр в точке (1, 1), радиус r₁ = 1
- Окружность 2: центр в точке (1.5, 2), радиус r₂ = √5/2 ≈ 1.118
- Окружность 3: центр в точке (2, 1.5), радиус r₃ = √5/2 ≈ 1.118

Нужно найти площадь фигуры, образованной пересечением всех трёх кругов (то есть область, которая лежит внутри каждого из трёх кругов одновременно).

Точное значение площади этого пересечения можно вычислить аналитически:
```
S_точная = 0.25π + 1.25·arcsin(0.8) - 1 ≈ 0.9445
```

Моя задача — проверить, насколько близко метод Монте-Карло может приблизиться к этому значению при разных параметрах.

---

## 2. Описание метода

### Общая идея алгоритма

Алгоритм довольно простой:

1. Сначала определяем прямоугольную область, которая гарантированно содержит всю фигуру пересечения
2. Генерируем N случайных точек внутри этого прямоугольника
3. Для каждой точки проверяем, лежит ли она внутри всех трёх окружностей одновременно
4. Считаю количество точек M, которые попали в пересечение
5. Оцениваем площадь по формуле: S ≈ (M/N) × площадь_прямоугольника

Чем больше точек N генерируется, тем точнее должна получиться оценка.

### Две стратегии выбора области

В задании просят сравнить две стратегии выбора прямоугольной области для генерации точек:

**Широкая область**: Берём прямоугольник [0, 3] × [0, 3], который заведомо содержит все три окружности целиком. Это самый простой и безопасный подход — мы точно не упустим ни одного куска искомой фигуры.

**Узкая область**: Берём прямоугольник, построенный на основе анализа расположения центров окружностей и величины их радиусов

### Технические детали реализации

Программу я написал на C++. Для генерации случайных чисел использовал генератор Mersenne Twister (std::mt19937_64) из стандартной библиотеки — он считается одним из лучших псевдослучайных генераторов с хорошими статистическими свойствами.

Проверка попадания точки внутрь окружности делается через расстояние: точка (x, y) лежит внутри окружности с центром (cx, cy) и радиусом r, если выполняется неравенство:
```
(x - cx)² + (y - cy)² ≤ r²
```

Для ускорения программы, сравниваются квадраты.

---

## 3. Экспериментальная часть

### Параметры экспериментов

Я провёл серию экспериментов, варьируя количество генерируемых точек N от 100 до 100,000 с шагом 500. Для каждого значения N я запускал алгоритм дважды — один раз с широкой областью, другой раз с узкой.

Для каждого запуска я измерял:
- Полученную оценку площади
- Относительную ошибку: |S_оценка - S_точная| / S_точная
- Время выполнения в миллисекундах

Все результаты сохранял в CSV-файлы для последующей обработки.

### Результаты

Результаты экспериментов представлены на графиках ниже.

**График 1: Зависимость оценки площади от N**

На левом графике видно, как оценка площади меняется с увеличением количества точек. При малых N (до 5000-10000) значения сильно скачут — то выше, то ниже точного значения. Это связано со случайным характером метода: при малом количестве точек влияние случайности очень велико.

По мере роста N флуктуации уменьшаются, и оценка стабилизируется около значения 0.9445. Интересно, что обе стратегии (широкая и узкая область) ведут себя примерно одинаково — обе сходятся к правильному ответу.

**График 2: Зависимость относительной ошибки от N**

На правом графике (с логарифмической шкалой по вертикали) показано, как меняется относительная ошибка. Здесь хорошо видна общая тенденция: ошибка уменьшается с ростом N, хотя из-за случайности точки на графике сильно разбросаны.

При N = 100 типичная ошибка составляет 10-20%, при N = 10,000 она падает до 1-2%, а при N = 100,000 достигает 0.1-0.2%.

Зелёная горизонтальная линия на уровне 0.01 (1%) показывает требуемую точность из условия задачи. Видно, что примерно начиная с N ≈ 15,000-20,000 большинство точек оказывается ниже этой линии, то есть требуемая точность достигается.

### Сравнение стратегий

Честно говоря, я ожидал, что узкая область будет давать заметно лучшие результаты — ведь там меньше "пустых" точек за пределами фигуры. Но на практике разница оказалась минимальной.

Обе стратегии показывают примерно одинаковую скорость сходимости. Узкая область иногда даёт чуть меньший разброс, но это не критично. Возможно, для более сложных фигур или других задач разница была бы заметнее.

Зато широкая область проще в реализации — не нужно заранее думать о том, где именно находится искомая фигура. Просто берёшь область побольше и всё.

---

## 4. Анализ и выводы

### Сходимость метода

Эксперименты подтверждают, что метод Монте-Карло действительно работает для данной задачи. Оценка площади сходится к правильному значению при увеличении количества точек. Это, конечно, было ожидаемо, но приятно видеть своими глазами.

### Скорость сходимости

Один из важных результатов — это скорость, с которой уменьшается ошибка. В теории для метода Монте-Карло ошибка должна убывать пропорционально 1/√N. Это означает, что чтобы уменьшить ошибку в 10 раз, нужно увеличить количество точек в 100 раз.

Мои данные в целом подтверждают эту закономерность, хотя из-за случайных флуктуаций на графике это видно не идеально.

Практический вывод отсюда такой: метод Монте-Карло неплох для грубых оценок (1-5% точности), но для высокой точности (0.01% и лучше) потребуется очень много точек. Например, чтобы гарантированно получить точность 0.01%, скорее всего, нужно генерировать миллионы точек.

### Требуемая точность

Для достижения точности 1%, которая требовалась в задании, оказалось достаточно примерно 15,000-20,000 точек. Это вполне разумное значение — программа с таким N выполняется за доли секунды.

Если взять N = 100,000, то точность улучшится до 0.1-0.2%, что уже очень неплохо для задачи такого типа.

### Вычислительная сложность

Время выполнения растёт линейно с N, что логично — мы просто генерируем больше точек и проверяем каждую из них. Никаких сложных вычислений в цикле нет, так что программа работает быстро.

На моём компьютере вычисление с N = 100,000 занимает около 100-150 миллисекунд, что вполне приемлемо. Даже миллион точек обрабатывается за 1-2 секунды.

### Практические рекомендации

На основе проведённых экспериментов могу дать следующие рекомендации:

1. Для быстрой грубой оценки (точность 5-10%) достаточно N ≈ 1,000-5,000
2. Для точности около 1% рекомендую N ≈ 20,000-50,000
3. Для точности 0.1% потребуется N ≈ 500,000-1,000,000
4. Выбор между широкой и узкой областью не критичен для данной задачи — можно использовать более простой вариант (широкую область)

### Ограничения метода

Важно понимать ограничения метода Монте-Карло:

1. **Вероятностная природа**: Результат зависит от последовательности случайных чисел. При разных запуска программы получатся немного разные ответы. Это нормально, но нужно учитывать.

2. **Медленная сходимость**: Чтобы улучшить точность в 10 раз, нужно в 100 раз больше точек. Для очень высокой точности это становится проблемой.

3. **Зависимость от генератора**: Качество результата зависит от качества генератора случайных чисел. Я использовал хороший генератор (Mersenne Twister), но для критичных приложений стоит проверять разные генераторы.

---

## 5. Заключение

В ходе работы я реализовал и исследовал метод Монте-Карло для вычисления площади пересечения трёх окружностей. Эксперименты показали, что метод работает надёжно и даёт хорошую точность при разумном количестве генерируемых точек.

Для данной конкретной задачи оптимальным выбором кажется N в диапазоне 20,000-50,000 — это обеспечивает точность около 1% при быстром времени выполнения.

Интересно, что выбор между широкой и узкой областью генерации точек оказался не так важен, как я ожидал. Обе стратегии дают сопоставимые результаты.

В целом, метод Монте-Карло показал себя как простой и эффективный инструмент для решения подобных геометрических задач. Особенно он ценен в ситуациях, когда аналитическое решение слишком сложное или вообще недоступно.

---

## Приложение: Технические детали

**Язык программирования**: C++17  
**Компилятор**: g++ с флагами -std=c++17 -O2  
**Генератор случайных чисел**: std::mt19937_64
**Визуализация данных**: Python 3 с библиотеками matplotlib и pandas

**Структура проекта**:
- `monte_carlo.cpp` — основная программа для решения задачи
- `experiment.cpp` — программа для проведения экспериментов
- `plot_results.py` — скрипт для построения графиков
- `wide_area.csv`, `narrow_area.csv` — результаты экспериментов

Все исходные коды и данные доступны в приложенном репозитории.